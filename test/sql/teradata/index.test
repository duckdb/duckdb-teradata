require teradata

# Pass teradata logon string as environment variable
# e.g. 'export TD_LOGON="127.0.0.1/dbc,dbc"`
require-env TD_LOGON

# Pass database name to use when creating test tables
# e.g. 'export TD_DB="duckdb_testdb"'
require-env TD_DB

# Attach teradata database
statement ok
attach '${TD_LOGON}' as td (TYPE TERADATA, DATABASE '${TD_DB}');

# Drop table if already exists
statement ok
DROP TABLE IF EXISTS td.test_table;

# Create a test table

statement ok
CREATE TABLE td.test_table(id INT, name VARCHAR);

statement ok
INSERT INTO td.test_table VALUES (0, 'zero');

statement ok
INSERT INTO td.test_table VALUES (1, 'one');

query II
SELECT * FROM td.test_table ORDER BY ALL;
----
0	zero
1	one

statement ok
CREATE UNIQUE INDEX test_table_idx ON td.test_table(id);

query IIIII
SELECT database_name, table_name, index_name, is_unique, is_primary FROM duckdb_indexes();
----
td	test_table	test_table_idx	1	0

statement error
INSERT INTO td.test_table VALUES (1, 'two');
----
Constraint Error: Secondary index uniqueness violation in

# clean up
statement ok
DROP TABLE IF EXISTS td.test_table;
